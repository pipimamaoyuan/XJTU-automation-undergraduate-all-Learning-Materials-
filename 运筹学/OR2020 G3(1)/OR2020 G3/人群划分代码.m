n=14;
s=10000;
p=2;q=1;
y1=23.88;y2=26.4;y3=22.2;y4=28.92;
x1=3.94;x2=4.15;x3=3.8;x4=4.23;
for k=1:1:n-1
    s=10000;
    for i=1:1:n-1
        for j=i+1:1:n
            a1=0;a2=0;a3=0;a4=0;a5=0;a6=0;a7=0;a8=0;
            b1=0;b2=0;b3=0;b4=0;b5=0;b6=0;b7=0;b8=0;
            if S1(i,2)~=0 && S1(j,2)~=0
                if (y2-S1(i,3))/S1(i,2)>x1 && (y2-S1(i,3))/S1(i,2)<=x2
                    a1=(y2-S1(i,3))/S1(i,2);
                    b1=y2;
                elseif (S1(i,2)*x2+S1(i,3))>y1 && (S1(i,2)*x2+S1(i,3))<y2
                    a1=x2;
                    b1=S1(i,2)*x2+S1(i,3);
                end
                if (y1-S1(i,3))/S1(i,2)>=x1 && (y1-S1(i,3))/S1(i,2)<x2
                    a2=(y1-S1(i,3))/S1(i,2);
                    b2=y1;
                elseif (S1(i,2)*x1+S1(i,3))>y1 && (S1(i,2)*x1+S1(i,3))<y2
                    a2=x1;
                    b2=S1(i,2)*x1+S1(i,3);
                end
                if (y2-S1(j,3))/S1(j,2)>x1 && (y2-S1(j,3))/S1(j,2)<=x2
                    a3=(y2-S1(j,3))/S1(j,2);
                    b3=y2;
                elseif (S1(j,2)*x2+S1(j,3))>y1 && (S1(j,2)*x2+S1(j,3))<y2
                    a3=x2;
                    b3=S1(j,2)*x2+S1(j,3);
                end
                if (y1-S1(j,3))/S1(j,2)>=x1 && (y1-S1(j,3))/S1(j,2)<x2
                    a4=(y1-S1(j,3))/S1(j,2);
                    b4=y1;
                elseif (S1(j,2)*x1+S1(j,3))>y1 && (S1(j,2)*x1+S1(j,3))<y2
                    a4=x1;
                    b4=S1(j,2)*x1+S1(j,3);
                end
                if a1>a3 || b1<b3
                    t=a3;a3=a1;a1=t;
                    t=b3;b3=b1;b1=t;
                end
                if a2>a4 || b2<b4
                    t=a4;a4=a2;a2=t;
                    t=b4;b4=b2;b2=t;
                end
                k1=(b1-b2)/(a1-a2);k2=(b3-b2)/(a3-a2);k3=(b3-b4)/(a3-a4);
                s1=(k1-k2)*((a1-a2)*(a3-a2)+(b1-b2)*(b3-b2))/(2*(1+k1*k2))+(k3-k2)*((a2-a3)*(a4-a3)+(b2-b3)*(b4-b3))/(2*(1+k2*k3));
               if (y4-S1(i,3))/S1(i,2)>x3 && (y4-S1(i,3))/S1(i,2)<=x4
                    a5=(y4-S1(i,3))/S1(i,2);
                    b5=y4;
                elseif (S1(i,2)*x4+S1(i,3))>y3 && (S1(i,2)*x4+S1(i,3))<y4
                    a5=x4;
                    b5=S1(i,2)*x4+S1(i,3);
                end
                if (y3-S1(i,3))/S1(i,2)>=x3 && (y3-S1(i,3))/S1(i,2)<x4
                    a6=(y3-S1(i,3))/S1(i,2);
                    b6=y3;
                elseif (S1(i,2)*x3+S1(i,3))>y3 && (S1(i,2)*x3+S1(i,3))<y4
                    a6=x3;
                    b6=S1(i,2)*x3+S1(i,3);
                end
                if (y4-S1(j,3))/S1(j,2)>x3 && (y4-S1(j,3))/S1(j,2)<=x4
                    a7=(y4-S1(j,3))/S1(j,2);
                    b7=y4;
                elseif (S1(j,2)*x4+S1(j,3))>y3 && (S1(j,2)*x4+S1(j,3))<y4
                    a7=x4;
                    b7=S1(j,2)*x4+S1(j,3);
                end
                if (y3-S1(j,3))/S1(j,2)>=x3 && (y3-S1(j,3))/S1(j,2)<x4
                    a8=(y3-S1(j,3))/S1(j,2);
                    b8=y3;
                elseif (S1(j,2)*x3+S1(j,3))>y3 && (S1(j,2)*x3+S1(j,3))<y4
                    a8=x3;
                    b8=S1(j,2)*x3+S1(j,3);
                end
                if a5>a7 || b5<b7
                    t=a7;a7=a5;a5=t;
                    t=b7;b7=b5;b5=t;
                end
                if a6>a8 || b6<b8
                    t=a8;a8=a6;a6=t;
                    t=b8;b8=b6;b6=t;
                end
                k1=(b5-b6)/(a5-a6);k2=(b7-b6)/(a7-a6);k3=(b7-b8)/(a7-a8);
                s2=(k1-k2)*((a5-a6)*(a7-a6)+(b5-b6)*(b7-b6))/(2*(1+k1*k2))+(k3-k2)*((a6-a7)*(a8-a7)+(b6-b7)*(b8-b7))/(2*(1+k2*k3));
                s0=s2;
               if s0<s
                   s=s0;
                   m1=i;
                   m2=j;
               end
               if s0<0
                   10000000000000000
               end
            end
        end
    end
    %a=S1(m1,1)
    %b=S1(m2,1)
    m1
    m2
    if S1(m1,2)==S1(m2,2)
        S1(m1,3)=(S1(m1,3)+S1(m2,3))/2;
        S1(m2,2)=0;
    else
        x=(S1(m2,3)-S1(m1,3))/(S1(m1,2)-S1(m2,2));
        y=S1(m1,2)*x+S1(m1,3);
        S1(m1,2)=(S1(m1,2)*(1+S1(m2,2)^2)^0.5+S1(m2,2)*(1+S1(m1,2)^2)^0.5)/((1+S1(m2,2)^2)^0.5+(1+S1(m1,2)^2)^0.5);
        S1(m1,3)=y-S1(m1,2)*x;
        S1(m2,2)=0;
    end
end